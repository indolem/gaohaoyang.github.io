<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>React Hooks 系列之4 useReducer</title>
    <meta name="description" content="掌握 React Hooks api 将更好的帮助你在工作中使用，对 React 的掌握更上一层楼。本系列将使用大量实例代码和效果展示，非常易于初学者和复习使用。截止目前我们已经学习了3个hook api，useState, useEffect, useContext。接下来我们学习下一个 hook api，us...">

    <link rel="shortcut icon" href="/indolem.png?" type="image/x-icon">
    <link rel="icon" href="/indolem.png?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="https://indolem.github.io/2020/05/13/react-hooks4-useReducer/">
    <link rel="alternate" type="application/rss+xml" title="IndoLEM" href="https://indolem.github.io/feed.xml ">





</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">IndoLEM</a>
        <small>Indonesian NLP Resource Collection</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/IndoBERT/">
                        
                            <i class="fa fa-microchip"></i>IndoBERT
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/Task/">
                        
                            <i class="fa fa-database"></i>Data and Tasks
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/leaderboard/">
                        
                            <i class="fa fa-th-list"></i>Leaderboard
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/team/">
                        
                            <i class="fa fa-heart"></i>Team
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>React Hooks 系列之4 useReducer</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2020-05-13
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>HyG
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#JavaScript" title="Category: JavaScript" rel="category">JavaScript</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#React" title="Tag: React" rel="tag">React</a-->
        <a href="/tag/#React" title="Tag: React" rel="tag">React</a>&nbsp;
    
        <!--a href="/tag/#hooks" title="Tag: hooks" rel="tag">hooks</a-->
        <a href="/tag/#hooks" title="Tag: hooks" rel="tag">hooks</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#usereducer" id="markdown-toc-usereducer">什么是 useReducer</a>    <ul>
      <li><a href="#reducer" id="markdown-toc-reducer">reducer</a></li>
      <li><a href="#reducer--usereducer" id="markdown-toc-reducer--usereducer">reducer 与 useReducer</a></li>
    </ul>
  </li>
  <li><a href="#simple-state--action" id="markdown-toc-simple-state--action">simple state &amp; action</a></li>
  <li><a href="#complex-state--action" id="markdown-toc-complex-state--action">complex state &amp; action</a></li>
  <li><a href="#multiple-usereducers" id="markdown-toc-multiple-usereducers">multiple useReducers</a></li>
  <li><a href="#usereducer-with-usecontext" id="markdown-toc-usereducer-with-usecontext">useReducer with useContext</a></li>
  <li><a href="#fetching-data-with-usereducer" id="markdown-toc-fetching-data-with-usereducer">Fetching Data with useReducer</a>    <ul>
      <li><a href="#usestate-" id="markdown-toc-usestate-">useState 实现请求</a></li>
      <li><a href="#usereducer-" id="markdown-toc-usereducer-">useReducer 实现请求</a></li>
    </ul>
  </li>
  <li><a href="#usestate-vs-usereducer" id="markdown-toc-usestate-vs-usereducer">useState vs useReducer</a></li>
  <li><a href="#section" id="markdown-toc-section">小结</a></li>
</ul>

<p>掌握 React Hooks api 将更好的帮助你在工作中使用，对 React 的掌握更上一层楼。本系列将使用大量实例代码和效果展示，非常易于初学者和复习使用。</p>

<p>截止目前我们已经学习了3个hook api，<code class="highlighter-rouge">useState</code>, <code class="highlighter-rouge">useEffect</code>, <code class="highlighter-rouge">useContext</code>。接下来我们学习下一个 hook api，<code class="highlighter-rouge">useReducer</code>。首先我们将讲讲什么是 reducer，以及为什么使用 reducer。研究一下 JavaScript 中的 reducer 是什么，这将有助于理解 react hook 中的 <code class="highlighter-rouge">useReducer</code>。好，现在开始吧。</p>

<h2 id="usereducer">什么是 useReducer</h2>

<p><code class="highlighter-rouge">useReducer</code> 是一个用于状态管理的 hook api。是 <code class="highlighter-rouge">useState</code> 的替代方案。</p>

<p>那么 <code class="highlighter-rouge">useReducer</code> 和 <code class="highlighter-rouge">useState</code> 的区别是什么呢？答案是<code class="highlighter-rouge">useState</code> 是使用 <code class="highlighter-rouge">useReducer</code> 构建的。</p>

<p>那么什么时候使用 <code class="highlighter-rouge">useReducer</code> 还是 <code class="highlighter-rouge">useState</code> 呢？我们完成本章的学习就能找到答案。</p>

<h3 id="reducer">reducer</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>useState - state
useEffect - side effects
useContext - context API
useReducer - reducers
</code></pre>
</div>

<p>可以看到 useReducer 一定也与 reducer 有关，接下来看看什么是 reducer。之所以要了解什么是 reducer 是为了你不需要掌握 redux 而学会 useReducer，当然，如果你了解Redux，对本章理解会更容易。下面开始</p>

<p>如果你研究过原生 JavaScript，你会发现有一些内置方法，如 <code class="highlighter-rouge">foreach</code>, <code class="highlighter-rouge">map</code>, <code class="highlighter-rouge">reduce</code>。我们来深入看一下 <code class="highlighter-rouge">reduce</code> 方法。在 MDN 上可以看到 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce"><code class="highlighter-rouge">Array.prototype.reduce()</code> 的文档</a>，文档中说</p>

<blockquote>
  <p>reduce() 方法对数组中的每个元素执行一个由您提供的 reducer 函数(升序执行)，将其结果汇总为单个返回值。</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">array1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
<span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">accumulator</span><span class="p">,</span> <span class="nx">currentValue</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">accumulator</span> <span class="o">+</span> <span class="nx">currentValue</span><span class="p">;</span>

<span class="c1">// 1 + 2 + 3 + 4</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array1</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">reducer</span><span class="p">));</span>
<span class="c1">// expected output: 10</span>

<span class="c1">// 5 + 1 + 2 + 3 + 4</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array1</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
<span class="c1">// expected output: 15</span>
</code></pre>
</div>

<p>需要注意的是：reduce 方法接受2个参数，第一个为 reducer 函数，第二个为初始值（给 reducer 函数使用）。reduce 方法返回函数累计处理的结果。</p>

<p>而 reducer 函数有2个必填入参：</p>

<ul>
  <li><code class="highlighter-rouge">accumulator</code> 累计器累计回调的返回值; 它是上一次调用回调时返回的累积值，或 initialValue。</li>
  <li><code class="highlighter-rouge">currentValue</code> 数组中正在处理的元素。</li>
</ul>

<h3 id="reducer--usereducer">reducer 与 useReducer</h3>

<p>reducer 与 useReducer 这两者之间有巨大的相似之处。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">reduce in JavaScript</th>
      <th style="text-align: left">useReducer in React</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">array.reduce(reducer, initialValue)</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">useReducer(reducer, initialState)</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">singleValue = reducer(accumulator, itemValue)</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">newState = reducer(currentState, action)</code></td>
    </tr>
    <tr>
      <td style="text-align: left">reduce method returns a single value</td>
      <td style="text-align: left">useReducer returns a pair of values. [newState, dispatch]</td>
    </tr>
  </tbody>
</table>

<p>上述表格目前看不懂也没有关系，后续通过例子会详细说明。</p>

<p>在这一小节我们学到了：</p>

<ul>
  <li><code class="highlighter-rouge">useReducer</code> 是一个用于状态管理的 hook api。</li>
  <li><code class="highlighter-rouge">useReducer</code> 与 reducer 函数有关</li>
  <li><code class="highlighter-rouge">useReducer(reducer, initialState)</code> 接受2个参数，分别为 reducer 函数 和 初始状态</li>
  <li><code class="highlighter-rouge">reducer(currentState, action)</code> 也是接受2个参数，分别为当前状态和 action，返回一个 new state</li>
</ul>

<h2 id="simple-state--action">simple state &amp; action</h2>

<p>在本节，我们来看一个计数器的例子，来学习 simple state &amp; action</p>

<ol>
  <li>import useReducer api</li>
  <li>声明 reducer function 和 initialState</li>
  <li>调用执行 reducer</li>
</ol>

<p>CounterOne.tsx</p>

<pre><code class="language-jsx">import React, { useReducer } from 'react'

const initialState = 0
const reducer = (state: number, action: string) =&gt; {
  switch (action) {
    case 'increment':
      return state + 1
    case 'decrement':
      return state - 1
    case 'reset':
      return initialState
    default:
      return state
  }
}

function CounterOne() {
  const [count, dispatch] = useReducer(reducer, initialState)
  return (
    &lt;div&gt;
      &lt;div&gt;Count - {count}&lt;/div&gt;
      &lt;button
        onClick={() =&gt; dispatch('increment')}
      &gt;Increment&lt;/button&gt;
      &lt;button
        onClick={() =&gt; dispatch('decrement')}
      &gt;Decrement&lt;/button&gt;
      &lt;button
        onClick={() =&gt; dispatch('reset')}
      &gt;Reset&lt;/button&gt;
    &lt;/div&gt;
  )
}

export default CounterOne

</code></pre>

<p>App.tsx</p>

<pre><code class="language-jsx">import React from 'react'

import './App.css'

import CounterOne from './components/19CounterOne'

const App = () =&gt; {
  return (
    &lt;div className="App"&gt;
      &lt;CounterOne /&gt;
    &lt;/div&gt;
  )
}

export default App
</code></pre>

<p>页面展示如下：</p>

<p><img src="https://gw.alicdn.com/tfs/TB17DPMFLb2gK0jSZK9XXaEgFXa-432-209.gif" alt="" /></p>

<p>在回顾一下代码，首先 import useReducer</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useReducer</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'react'</span>
</code></pre>
</div>

<p>然后调用 useReducer</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">initialState</span><span class="p">)</span>
</code></pre>
</div>

<p>声明 reducer, initialState</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">initialState</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="err">:</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">action</span><span class="err">:</span> <span class="nx">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'increment'</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">state</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">case</span> <span class="s1">'decrement'</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">state</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">case</span> <span class="s1">'reset'</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">initialState</span>
    <span class="na">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">state</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>reducer function 的2个参数，分别为当前 state 和 action， 并根据不同的 action 返回不同的新的 state。</p>

<p>useReducer 返回了一个数组，2个元素分别为 state 和 dispatch 方法。其中 state 在我们的例子中就是当前的 count 值，dispatch 方法接受一个参数，执行对应的 action。dispatch 执行后，对应的 state 会改变，组件会 rerender，来展示最新的状态。</p>

<p>这就是使用 simple state 和 simple action 的例子，本例中 state 是一个 number 类型，action 也是简单的 string 类型，这和 Redux 的模式稍有不同。接下来我们看一个稍复杂的例子。</p>

<h2 id="complex-state--action">complex state &amp; action</h2>

<p>下面我们看第二个例子。将使用对象作为 state 和 action 的值，这就比较类似 Redux 的模式了。</p>

<p>CounterTwo.tsx<br />
``` jsx<br />
import React, { useReducer } from ‘react’</p>

<p>const initialState = {<br />
  firstCounter: 0<br />
}<br />
const reducer = (<br />
  state: {<br />
    firstCounter: number<br />
  },<br />
  action: {<br />
    type: string<br />
  }<br />
) =&gt; {<br />
  switch (action.type) {<br />
    case ‘increment’:<br />
      return {<br />
        firstCounter: state.firstCounter + 1<br />
      }<br />
    case ‘decrement’:<br />
      return {<br />
        firstCounter: state.firstCounter - 1<br />
      }<br />
    case ‘reset’:<br />
      return initialState<br />
    default:<br />
      return state<br />
  }<br />
}</p>

<p>function CounterTwo() {<br />
  const [count, dispatch] = useReducer(reducer, initialState)<br />
  return (<br />
    &lt;div&gt;<br />
      &lt;div&gt;Count - {count.firstCounter}&lt;/div&gt;<br />
      &lt;button<br />
        onClick={() =&gt; dispatch({ type: ‘increment’ })}<br />
      &gt;Increment&lt;/button&gt;<br />
      &lt;button<br />
        onClick={() =&gt; dispatch({ type: ‘decrement’ })}<br />
      &gt;Decrement&lt;/button&gt;<br />
      &lt;button<br />
        onClick={() =&gt; dispatch({ type: ‘reset’ })}<br />
      &gt;Reset&lt;/button&gt;<br />
    &lt;/div&gt;<br />
  )<br />
}</p>

<p>export default CounterTwo<br />
```</p>

<p>App.tsx</p>

<pre><code class="language-jsx">import React from 'react'

import './App.css'

import CounterTwo from './components/20CountTwo'

const App = () =&gt; {
  return (
    &lt;div className="App"&gt;
      &lt;CounterTwo /&gt;
    &lt;/div&gt;
  )
}

export default App
</code></pre>

<p>页面展示如下：</p>

<p><img src="https://gw.alicdn.com/tfs/TB17DPMFLb2gK0jSZK9XXaEgFXa-432-209.gif" alt="" /></p>

<p>与上一节的示例效果相同。现在，我们已经将 state 和 action 都改写为对象了，那么这样写有什么好处呢？</p>

<p>其一的好处是 action 现在是一个对象了，可以有多个属性决定 action 的效果。例如我们再添加一个 +5 的逻辑。</p>

<p>CounterTwo.tsx<br />
``` jsx<br />
import React, { useReducer } from ‘react’</p>

<p>const initialState = {<br />
  firstCounter: 0<br />
}<br />
const reducer = (<br />
  state: {<br />
    firstCounter: number<br />
  },<br />
  action: {<br />
    type: string<br />
    value: number<br />
  }<br />
) =&gt; {<br />
  switch (action.type) {<br />
    case ‘increment’:<br />
      return {<br />
        firstCounter: state.firstCounter + action.value<br />
      }<br />
    case ‘decrement’:<br />
      return {<br />
        firstCounter: state.firstCounter - action.value<br />
      }<br />
    case ‘reset’:<br />
      return initialState<br />
    default:<br />
      return state<br />
  }<br />
}</p>

<p>function CounterTwo() {<br />
  const [count, dispatch] = useReducer(reducer, initialState)<br />
  return (<br />
    &lt;div&gt;<br />
      &lt;div&gt;Count - {count.firstCounter}&lt;/div&gt;<br />
      &lt;button<br />
        onClick={() =&gt; dispatch({<br />
          type: ‘increment’,<br />
          value: 1<br />
        })}<br />
      &gt;Increment&lt;/button&gt;<br />
      &lt;button<br />
        onClick={() =&gt; dispatch({<br />
          type: ‘decrement’,<br />
          value: 1<br />
        })}<br />
      &gt;Decrement&lt;/button&gt;<br />
      &lt;button<br />
        onClick={() =&gt; dispatch({<br />
          type: ‘increment’,<br />
          value: 5<br />
        })}<br />
      &gt;Increment 5&lt;/button&gt;<br />
      &lt;button<br />
        onClick={() =&gt; dispatch({<br />
          type: ‘decrement’,<br />
          value: 5<br />
        })}<br />
      &gt;Decrement 5&lt;/button&gt;<br />
      &lt;button<br />
        onClick={() =&gt; dispatch({ type: ‘reset’, value: 0})}<br />
      &gt;Reset&lt;/button&gt;<br />
    &lt;/div&gt;<br />
  )<br />
}</p>

<p>export default CounterTwo<br />
```</p>

<p>页面展示如下：<br />
<img src="https://gw.alicdn.com/tfs/TB1YCL3FKL2gK0jSZFmXXc7iXXa-432-209.gif" alt="" /></p>

<p>可以注意到给 action 增加了一个 value 属性，实现了加减 5 的逻辑。</p>

<p>第二个好处是 state 作为一个对象，就可以添加更多的 state 属性，例如我们在增加一个计数器2，代码如下：</p>

<pre><code class="language-jsx">import React, { useReducer } from 'react'

const initialState = {
  firstCounter: 0,
  secondCounter: 10,
}
const reducer = (
  state: {
    firstCounter: number
    secondCounter: number
  },
  action: {
    type: string
    value: number
  }
) =&gt; {
  switch (action.type) {
    case 'increment':
      return {
        ...state,
        firstCounter: state.firstCounter + action.value
      }
    case 'decrement':
      return {
        ...state,
        firstCounter: state.firstCounter - action.value
      }
    case 'increment2':
      return {
        ...state,
        secondCounter: state.secondCounter + action.value
      }
    case 'decrement2':
      return {
        ...state,
        secondCounter: state.secondCounter - action.value
      }
    case 'reset':
      return initialState
    default:
      return state
  }
}

function CounterTwo() {
  const [count, dispatch] = useReducer(reducer, initialState)
  return (
    &lt;div&gt;
      &lt;div&gt;First Count - {count.firstCounter}&lt;/div&gt;
      &lt;div&gt;Second Count - {count.secondCounter}&lt;/div&gt;
      &lt;button
        onClick={() =&gt; dispatch({
          type: 'increment',
          value: 1
        })}
      &gt;Increment&lt;/button&gt;
      &lt;button
        onClick={() =&gt; dispatch({
          type: 'decrement',
          value: 1
        })}
      &gt;Decrement&lt;/button&gt;
      &lt;button
        onClick={() =&gt; dispatch({
          type: 'increment',
          value: 5
        })}
      &gt;Increment 5&lt;/button&gt;
      &lt;button
        onClick={() =&gt; dispatch({
          type: 'decrement',
          value: 5
        })}
      &gt;Decrement 5&lt;/button&gt;
      &lt;div&gt;
        &lt;button
          onClick={() =&gt; dispatch({
            type: 'increment2',
            value: 1
          })}
        &gt;Increment second&lt;/button&gt;
        &lt;button
          onClick={() =&gt; dispatch({
            type: 'decrement2',
            value: 1
          })}
        &gt;Decrement second&lt;/button&gt;
      &lt;/div&gt;
      &lt;button
        onClick={() =&gt; dispatch({ type: 'reset', value: 0 })}
      &gt;Reset&lt;/button&gt;
    &lt;/div&gt;
  )
}

export default CounterTwo
</code></pre>

<p>页面展示效果如下</p>

<p><img src="https://gw.alicdn.com/tfs/TB1SQPZFFY7gK0jSZKzXXaikpXa-432-209.gif" alt="" /></p>

<p>这样我们就能同时维护 2 个计时器。</p>

<h2 id="multiple-usereducers">multiple useReducers</h2>

<p>如果有多个 state，但 state 变化的方式又是相同的时候，可以多次使用 useReducer。</p>

<p>CounterThree.tsx</p>

<pre><code class="language-jsx">import React, { useReducer } from 'react'

const initialState = 0
const reducer = (state: number, action: string) =&gt; {
  switch (action) {
    case 'increment':
      return state + 1
    case 'decrement':
      return state - 1
    case 'reset':
      return initialState
    default:
      return state
  }
}

function CounterThree() {
  const [count, dispatch] = useReducer(reducer, initialState)
  const [countTwo, dispatchTwo] = useReducer(reducer, initialState)
  return (
    &lt;div&gt;
      &lt;div&gt;Count - {count}&lt;/div&gt;
      &lt;button
        onClick={() =&gt; dispatch('increment')}
      &gt;Increment&lt;/button&gt;
      &lt;button
        onClick={() =&gt; dispatch('decrement')}
      &gt;Decrement&lt;/button&gt;
      &lt;button
        onClick={() =&gt; dispatch('reset')}
      &gt;Reset&lt;/button&gt;

      &lt;br/&gt;

      &lt;div&gt;CountTwo - {countTwo}&lt;/div&gt;
      &lt;button
        onClick={() =&gt; dispatchTwo('increment')}
      &gt;Increment&lt;/button&gt;
      &lt;button
        onClick={() =&gt; dispatchTwo('decrement')}
      &gt;Decrement&lt;/button&gt;
      &lt;button
        onClick={() =&gt; dispatchTwo('reset')}
      &gt;Reset&lt;/button&gt;
    &lt;/div&gt;
  )
}

export default CounterThree
</code></pre>

<p>页面展示如下</p>

<p><img src="https://gw.alicdn.com/tfs/TB1f9P5FKT2gK0jSZFvXXXnFXXa-432-209.gif" alt="" /></p>

<p>这个例子中使用了多个 useReducer，但共用了一个 reducer function。这有效的避免了合并对象的麻烦（可以对比上一节使用展开运算法合并 state）。也提高了代码的复用性。</p>

<h2 id="usereducer-with-usecontext">useReducer with useContext</h2>

<p>截止目前我们已经学习了在组件内使用 useReducer 进行状态管理。如果在某些场景想再组件之间分享 state，进行全局的 state 管理时，我们可以使用 useReducer 加 useContext。</p>

<p>考虑这样一个场景，有3个子组件A, B, C，要在子组件内控制同一个计数器，常规的写法是将 counter 的方法写到父组件上，然后通过 props 的方式将 counter 方法和 state 传给子组件，子组件中调用通过 props 传入的 counter 方法，就会改变父组件中的 state，同时也能改变作为 props 传递给子组件的 app 中的 state。如下图：</p>

<p><img src="https://gw.alicdn.com/tfs/TB14QMhFQL0gK0jSZFAXXcA9pXa-717-274.png" alt="" /></p>

<p>看起来没什么问题，但是如果组件嵌套比较深的时候，这将非常糟糕，要一层一层将 counter 方法作为 props 传递给子组件。这时就要使用 useContext 加 useReducer 了。</p>

<p><img src="https://gw.alicdn.com/tfs/TB18LclFUY1gK0jSZFCXXcwqXXa-717-488.png" alt="" /></p>

<p>要完成这个需求分为 2 步</p>

<ol>
  <li>使用 useReducer 在根节点创建一个 counter 方法</li>
  <li>通过 useContext 为子组件提供和消费 context</li>
</ol>

<p>App.tsx</p>

<pre><code class="language-jsx">import React, { useReducer } from 'react'
import './App.css'
import A from './components/22A'
import B from './components/22B'
import C from './components/22C'

interface CountContextType {
  countState: number
  countDispatch: (action: string) =&gt; void
}

export const CountContext = React.createContext({} as CountContextType)

const initialState = 0
const reducer = (state: number, action: string) =&gt; {
  switch (action) {
    case 'increment':
      return state + 1
    case 'decrement':
      return state - 1
    case 'reset':
      return initialState
    default:
      return state
  }
}

const App = () =&gt; {
  const [count, dispatch] = useReducer(reducer, initialState)
  return (
    &lt;CountContext.Provider
      value=
    &gt;
      &lt;div className="App"&gt;
        Count - {count}
        &lt;A /&gt;
        &lt;B /&gt;
        &lt;C /&gt;
      &lt;/div&gt;
    &lt;/CountContext.Provider&gt;
  )
}

export default App
</code></pre>

<p>A.tsx</p>

<pre><code class="language-jsx">import React, { useContext } from 'react'
import { CountContext } from '../App'

function A() {
  const countContext = useContext(CountContext)
  return (
    &lt;div&gt;
      A - {countContext.countState}
      &lt;button
        onClick={() =&gt; countContext.countDispatch('increment')}
      &gt;Increment&lt;/button&gt;
      &lt;button
        onClick={() =&gt; countContext.countDispatch('decrement')}
      &gt;Decrement&lt;/button&gt;
      &lt;button
        onClick={() =&gt; countContext.countDispatch('reset')}
      &gt;Reset&lt;/button&gt;
    &lt;/div&gt;
  )
}

export default A
</code></pre>
<p>B.tsx</p>

<pre><code class="language-jsx">import React from 'react'
import D from './22D'

function B() {
  return (
    &lt;div&gt;
      &lt;D /&gt;
    &lt;/div&gt;
  )
}

export default B
</code></pre>

<p>C.tsx</p>

<pre><code class="language-jsx">import React from 'react'
import E from './22E'

function C() {
  return (
    &lt;div&gt;
      &lt;E /&gt;
    &lt;/div&gt;
  )
}

export default C
</code></pre>

<p>D.tsx</p>

<pre><code class="language-jsx">import React, { useContext } from 'react'
import { CountContext } from '../App'

function D() {
  const countContext = useContext(CountContext)
  return (
    &lt;div&gt;
      D - {countContext.countState}
      &lt;button
        onClick={() =&gt; countContext.countDispatch('increment')}
      &gt;Increment&lt;/button&gt;
      &lt;button
        onClick={() =&gt; countContext.countDispatch('decrement')}
      &gt;Decrement&lt;/button&gt;
      &lt;button
        onClick={() =&gt; countContext.countDispatch('reset')}
      &gt;Reset&lt;/button&gt;
    &lt;/div&gt;
  )
}

export default D
</code></pre>

<p>E.tsx</p>

<pre><code class="language-jsx">import React from 'react'

import F from './22F'

function E() {
  return (
    &lt;div&gt;
      &lt;F /&gt;
    &lt;/div&gt;
  )
}

export default E
</code></pre>

<p>F.tsx</p>

<pre><code class="language-jsx">import React, { useContext } from 'react'
import { CountContext } from '../App'

function F() {
  const countContext = useContext(CountContext)
  return (
    &lt;div&gt;
      F - {countContext.countState}
      &lt;button
        onClick={() =&gt; countContext.countDispatch('increment')}
      &gt;Increment&lt;/button&gt;
      &lt;button
        onClick={() =&gt; countContext.countDispatch('decrement')}
      &gt;Decrement&lt;/button&gt;
      &lt;button
        onClick={() =&gt; countContext.countDispatch('reset')}
      &gt;Reset&lt;/button&gt;
    &lt;/div&gt;
  )
}

export default F
</code></pre>

<p>页面效果如下</p>

<p><img src="https://gw.alicdn.com/tfs/TB19OorFHj1gK0jSZFuXXcrHpXa-432-209.gif" alt="" /></p>

<p>我们再一起回顾一下</p>

<ol>
  <li>在 App.tsx 中，我们使用 useReducer 创建了一个 counter，声明了初始值，创建了 reducer 函数，useReducer 返回了状态 count 和 dispatch 方法。</li>
  <li>为了能让其他组件访问到 count 和 dispatch，我们通过 React.createContext 创建了 CountContext，并用 <code class="highlighter-rouge">&lt;CountContext.Provider&gt;</code> 包裹根节点。将 count 和 dispatch 作为 value 传给 Provider。</li>
  <li>在子节点中，我们使用 useContext 获取到 count 和 dispatch 方法，通过调用 dispatch 实现对 count 的改变。</li>
</ol>

<h2 id="fetching-data-with-usereducer">Fetching Data with useReducer</h2>

<p>之前我们已经在 useEffect 的章节中学习掌握了如何请求数据，当时是使用了 useEffect 和 useState，现在我们再来看看如何使用 useReducer 去请求远程数据。</p>

<p>接下来我们做这样一个小需求：</p>

<ol>
  <li>页面载入时请求数据</li>
  <li>请求数据中展示 loading 状态</li>
  <li>请求返回后移除 loading 样式，展示请求的数据；若请求失败，也移除 loading 展示错误提示</li>
</ol>

<p>我们将分别使用 useState 和 useReducer 来实现，并对比其中的区别。</p>

<h3 id="usestate-">useState 实现请求</h3>

<p>App.tsx</p>

<pre><code class="language-jsx">import React from 'react'
import './App.css'

import DataFetchingOne from './components/23DataFetchingOne'

const App = () =&gt; {
  return (
    &lt;div className="App"&gt;
      &lt;DataFetchingOne /&gt;
    &lt;/div&gt;
  )
}

export default App
</code></pre>

<p>DataFetchingOne.tsx</p>

<pre><code class="language-jsx">import React, { useState, useEffect } from 'react'
import axios from 'axios'

interface postType {
  userId: number
  id: number
  title: string
  body: string
}

function DataFetchingOne() {
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState('')
  const [post, setPost] = useState({} as postType)

  useEffect(() =&gt; {
    axios.get('https://jsonplaceholder.typicode.com/posts/1').then((res) =&gt; {
      setLoading(false)
      setPost(res.data)
      setError('')
    }).catch(() =&gt; {
      setLoading(false)
      setPost({} as postType)
      setError('something went wrong')
    })
  }, [])

  return (
    &lt;div&gt;
      {
        loading
          ? 'Loading...'
          : post.title
      }
      {
        error
          ? error
          : null
      }
    &lt;/div&gt;
  )
}

export default DataFetchingOne
</code></pre>

<p>页面效果如下</p>

<p><img src="https://gw.alicdn.com/tfs/TB1Gg8wFYr1gK0jSZR0XXbP8XXa-557-209.gif" alt="" /></p>

<p>我们故意改错一个 axios 请求的链接，可以看到如下进入错误的逻辑。</p>

<p><img src="https://gw.alicdn.com/tfs/TB1kHNxFYr1gK0jSZFDXXb9yVXa-557-209.gif" alt="" /></p>

<p>注意到在这个实现中，我们使用了3个useState去控制 loading, post 和 error，接下来看看如何使用 useReducer 实现。</p>

<h3 id="usereducer-">useReducer 实现请求</h3>

<p>App.tsx</p>

<pre><code class="language-jsx">import React from 'react'
import './App.css'

import DataFetchingOne from './components/23DataFetchingOne'

const App = () =&gt; {
  return (
    &lt;div className="App"&gt;
      &lt;DataFetchingOne /&gt;
    &lt;/div&gt;
  )
}

export default App
</code></pre>

<pre><code class="language-jsx">import React, { useEffect, useReducer } from 'react'
import axios from 'axios'

interface postType {
  userId: number
  id: number
  title: string
  body: string
}

type stateType = {
  loading: boolean
  error: string
  post?: postType | {}
}

type actionType = {
  type: 'FETCH_SUCCESS' | 'FETCH_ERROR'
  payload?: postType | {}
}

const initialState = {
  loading: true,
  error: '',
  post: {},
}

const reducer = (state: stateType, action: actionType) =&gt; {
  switch (action.type) {
    case 'FETCH_SUCCESS':
      return {
        loading: false,
        error: '',
        post: action.payload,
      }
    case 'FETCH_ERROR':
      return {
        loading: false,
        error: 'something went wrong',
        post: {},
      }
    default:
      return state
  }
}

function DataFetchingTwo() {
  const [state, dispatch] = useReducer(reducer, initialState)

  useEffect(() =&gt; {
    axios.get('https://jsonplaceholder.typicode.com/posts/1').then((res) =&gt; {
      dispatch({
        type: 'FETCH_SUCCESS',
        payload: res.data,
      })
    }).catch(() =&gt; {
      dispatch({
        type: 'FETCH_ERROR'
      })
    })
  }, [])

  return (
    &lt;div&gt;
      {
        state.loading
          ? 'Loading...'
          // @ts-ignore
          : state.post.title
      }
      {
        state.error
          ? state.error
          : null
      }
    &lt;/div&gt;
  )
}

export default DataFetchingTwo
</code></pre>

<p>页面展示效果与上一个例子相同</p>

<p><img src="https://gw.alicdn.com/tfs/TB1Gg8wFYr1gK0jSZR0XXbP8XXa-557-209.gif" alt="" /></p>

<p>可以看到，我们将 state 集合在了一起，在同一个对象，修改 state 的逻辑也聚合在了一起，即 reducer 函数中的 switch 部分。</p>

<p>至此你可能会好奇，什么时候该用 useState 什么时候该用 useReducer，我们继续往下看。</p>

<h2 id="usestate-vs-usereducer">useState vs useReducer</h2>

<ul>
  <li>如果 state 的类型为 Number, String, Boolean 建议使用 useState，如果 state 的类型 为 Object 或 Array，建议使用 useReducer</li>
  <li>如果 state 变化非常多，也是建议使用 useReducer，集中管理 state 变化，便于维护</li>
  <li>如果 state 关联变化，建议使用 useReducer</li>
  <li>业务逻辑如果很复杂，也建议使用 useReducer</li>
  <li>如果 state 只想用在 组件内部，建议使用 useState，如果想维护全局 state 建议使用 useReducer</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Scenario</th>
      <th>useState</th>
      <th>useReducer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Type of state</td>
      <td>Number, String, Boolean</td>
      <td>Object or Array</td>
    </tr>
    <tr>
      <td>Number of state transitions</td>
      <td>1 or 2</td>
      <td>Too many</td>
    </tr>
    <tr>
      <td>Related state transitions</td>
      <td>No</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td>Business logic</td>
      <td>No business logic</td>
      <td>Complex business logic</td>
    </tr>
    <tr>
      <td>local vs global</td>
      <td>local</td>
      <td>global</td>
    </tr>
  </tbody>
</table>

<h2 id="section">小结</h2>

<p>本章主要讲述了 useReducer 的使用方法。从 JavaScript 中的 reduce api 开始，对比说明了什么是 useReducer。</p>

<p>学习了 useReducer 的简单状态的使用，复杂状态的使用，以及多个 useReducer 的使用。</p>

<p>掌握了组件嵌套多层时使用 useContext 加 useReducer 完成子组件修改全局state的方法，代码更优雅，可维护性更高。</p>

<p>通过对比 useState，学习了如何使用 useEffect 加 useReducer 请求数据，并控制 loading 状态的显示隐藏。</p>

<p>最后对比了 useState 和 useReducer，并给出了使用建议。</p>

        </article>
        <hr>

        
        
            
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2020/05/27/react-hooks8-customHooks/">React Hooks 系列之8 custom Hook
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2020/05/26/react-hooks7-useRef/">React Hooks 系列之7 useRef
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2020/05/19/react-hooks6-useMemo/">React Hooks 系列之6 useMemo
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2020/05/18/react-hooks5-useCallback/">React Hooks 系列之5 useCallback
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2020/05/12/react-hooks3-useContext/">React Hooks 系列之3 useContext
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2020/05/11/react-hooks2-useEffect/">React Hooks 系列之2 useEffect
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2020/05/12/react-hooks3-useContext/">React Hooks 系列之3 useContext</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2020/05/18/react-hooks5-useCallback/">React Hooks 系列之5 useCallback</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        


<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function() {
        this.page.url = 'https://indolem.github.io/2020/05/13/react-hooks4-useReducer/'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'https://indolem.github.io/2020/05/13/react-hooks4-useReducer/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//ffajri.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">
    <div class="wrapper">
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/indolem" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:indolem.benchmark@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>    
            <a href="https://twitter.com/fajrikoto" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a>     
        </p>
        <p>
            Terimakasih, Ayo Kita Majukan NLP Indonesia    
        </p>
        <p class="power">
            <span>
                &copy; IndoLEM 2020.
            </span>
        </p>
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
